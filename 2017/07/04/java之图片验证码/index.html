

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    
    <meta name="author" content="parry">
    
    <meta name="description" content="图片验证码是一般常用在注册登录页面的功能，在一定程度上能减少用户的恶意注册，恶意登录行为，所以在一定程度上还是起了一定的作用的，当然还有别的场景也需要，总而言之是有必要的是需要会做的
验证码工具类1234567891011121314151617181920212223242526272829303">
    
    

    
    <link rel="alternative" href="YOUR_RSS_ADDRESS" title="parry" type="application/atom+xml">
    
    
    <link rel="icon" href="/blog/favicon.png">
    
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>java之图片验证码 | parry</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/blog/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/blog/css/style.css">

    <!-- Javascript -->
    <script src="/blog/js/jquery-2.1.0.min.js"></script>
    
    <script src="/blog/bootstrap/js/bootstrap.min.js"></script>

    <script src="/blog/js/common.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a target="_blank" class="navbar-brand" href="http://code-helloworld.com" title="parry">parry</a>

            
            </div>

            <div role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
                
                <a id="search" href="javascript:" class="navbar-text pull-right">搜索</a>
                <ul class="nav navbar-nav">
                    
                    <li id="nav-index"><a href="/blog">首页</a></li>
                    
                    <li id="nav-archives"><a href="/blog/archives">归档</a></li>
                    
                    
                    <li><a href="https://github.com/adminparry" target="_blank">GitHub</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div style="width:100%;height:100%;background:white;display:none;">
 
    </div>
    <script>
    var backRoot = "/blog/images/background/";
    var backArray = [ "1.jpg", "2.jpg", "3.jpg",  ];
        
    $(function() {
        // page-id...
        var pageId = "2017/07/04/java之图片验证码/";
        pageId = pageId.substr(0, pageId.indexOf("/"));
        if(pageId === "") pageId = "index";
        
        $("#nav-" + pageId).addClass("active");
        $('#search').click(function(){

        })
    });
    </script>

    <article class="post container">
    <div class="well post-body first-post last-post">
        <h1>java之图片验证码</h1>
        
        <div class="time-info">
发表于:<time datetime="2017-07-04T03:16:56.702Z" itemprop="datePublished">2017-07-04</time>，更新于:<time datetime="2017-07-04T07:23:41.693Z" itemprop="dateModified">2017-07-04</time>，By <a href="http://code-helloworld.com" title="parry">parry</a>
        </div>
        
        <div class="post-body-inner">
            <div id="toc" class="toc-article well">
                <strong class="toc-title">大纲</strong>
                <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#验证码工具类"><span class="toc-number">1.</span> <span class="toc-text">验证码工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用servlet实现图片验证码"><span class="toc-number">2.</span> <span class="toc-text">使用servlet实现图片验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用spring实现图片验证码"><span class="toc-number">3.</span> <span class="toc-text">使用spring实现图片验证码</span></a></li></ol>
            </div>
            <div class="description">

            <p>图片验证码是一般常用在注册登录页面的功能，在一定程度上能减少用户的恶意注册，恶意登录行为，所以在一定程度上还是起了一定的作用的，当然还有别的场景也需要，总而言之是有必要的是需要会做的</p>
<h3 id="验证码工具类"><a href="#验证码工具类" class="headerlink" title="验证码工具类"></a>验证码工具类</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div></pre></td><td class="code"><pre><div class="line">package com.utils;</div><div class="line"></div><div class="line">import java.awt.Color;  </div><div class="line">import java.awt.Font;  </div><div class="line">import java.awt.Graphics;  </div><div class="line">import java.awt.Graphics2D;  </div><div class="line">import java.awt.RenderingHints;  </div><div class="line">import java.awt.geom.AffineTransform;  </div><div class="line">import java.awt.image.BufferedImage;  </div><div class="line">import java.io.File;  </div><div class="line">import java.io.FileOutputStream;  </div><div class="line">import java.io.IOException;  </div><div class="line">import java.io.OutputStream;  </div><div class="line">import java.util.Arrays;  </div><div class="line">import java.util.Random;  </div><div class="line">  </div><div class="line">import javax.imageio.ImageIO;  </div><div class="line">  </div><div class="line">public class VerifyCodeUtils&#123;  </div><div class="line">  </div><div class="line">    //使用到Algerian字体，系统里没有的话需要安装字体，字体只显示大写，去掉了1,0,i,o几个容易混淆的字符  </div><div class="line">    public static final String VERIFY_CODES = <span class="string">"23456789ABCDEFGHJKLMNPQRSTUVWXYZ"</span>;  </div><div class="line">    private static Random random = new Random();  </div><div class="line">  </div><div class="line">  </div><div class="line">    /** </div><div class="line">     * 使用系统默认字符源生成验证码 </div><div class="line">     * @param verifySize    验证码长度 </div><div class="line">     * @<span class="built_in">return</span> </div><div class="line">     */  </div><div class="line">    public static String generateVerifyCode(int verifySize)&#123;  </div><div class="line">        <span class="built_in">return</span> generateVerifyCode(verifySize, VERIFY_CODES);  </div><div class="line">    &#125;  </div><div class="line">    /** </div><div class="line">     * 使用指定源生成验证码 </div><div class="line">     * @param verifySize    验证码长度 </div><div class="line">     * @param sources   验证码字符源 </div><div class="line">     * @<span class="built_in">return</span> </div><div class="line">     */  </div><div class="line">    public static String generateVerifyCode(int verifySize, String sources)&#123;  </div><div class="line">        <span class="keyword">if</span>(sources == null || sources.length() == 0)&#123;  </div><div class="line">            sources = VERIFY_CODES;  </div><div class="line">        &#125;  </div><div class="line">        int codesLen = sources.length();  </div><div class="line">        Random rand = new Random(System.currentTimeMillis());  </div><div class="line">        StringBuilder verifyCode = new StringBuilder(verifySize);  </div><div class="line">        <span class="keyword">for</span>(int i = 0; i &lt; verifySize; i++)&#123;  </div><div class="line">            verifyCode.append(sources.charAt(rand.nextInt(codesLen-1)));  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">return</span> verifyCode.toString();  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /** </div><div class="line">     * 生成随机验证码文件,并返回验证码值 </div><div class="line">     * @param w </div><div class="line">     * @param h </div><div class="line">     * @param outputFile </div><div class="line">     * @param verifySize </div><div class="line">     * @<span class="built_in">return</span> </div><div class="line">     * @throws IOException </div><div class="line">     */  </div><div class="line">    public static String outputVerifyImage(int w, int h, File outputFile, int verifySize) throws IOException&#123;  </div><div class="line">        String verifyCode = generateVerifyCode(verifySize);  </div><div class="line">        outputImage(w, h, outputFile, verifyCode);  </div><div class="line">        <span class="built_in">return</span> verifyCode;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /** </div><div class="line">     * 输出随机验证码图片流,并返回验证码值 </div><div class="line">     * @param w </div><div class="line">     * @param h </div><div class="line">     * @param os </div><div class="line">     * @param verifySize </div><div class="line">     * @<span class="built_in">return</span> </div><div class="line">     * @throws IOException </div><div class="line">     */  </div><div class="line">    public static String outputVerifyImage(int w, int h, OutputStream os, int verifySize) throws IOException&#123;  </div><div class="line">        String verifyCode = generateVerifyCode(verifySize);  </div><div class="line">        outputImage(w, h, os, verifyCode);  </div><div class="line">        <span class="built_in">return</span> verifyCode;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /** </div><div class="line">     * 生成指定验证码图像文件 </div><div class="line">     * @param w </div><div class="line">     * @param h </div><div class="line">     * @param outputFile </div><div class="line">     * @param code </div><div class="line">     * @throws IOException </div><div class="line">     */  </div><div class="line">    public static void outputImage(int w, int h, File outputFile, String code) throws IOException&#123;  </div><div class="line">        <span class="keyword">if</span>(outputFile == null)&#123;  </div><div class="line">            <span class="built_in">return</span>;  </div><div class="line">        &#125;  </div><div class="line">        File dir = outputFile.getParentFile();  </div><div class="line">        <span class="keyword">if</span>(!dir.exists())&#123;  </div><div class="line">            dir.mkdirs();  </div><div class="line">        &#125;  </div><div class="line">        try&#123;  </div><div class="line">            outputFile.createNewFile();  </div><div class="line">            FileOutputStream fos = new FileOutputStream(outputFile);  </div><div class="line">            outputImage(w, h, fos, code);  </div><div class="line">            fos.close();  </div><div class="line">        &#125; catch(IOException e)&#123;  </div><div class="line">            throw e;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /** </div><div class="line">     * 输出指定验证码图片流 </div><div class="line">     * @param w </div><div class="line">     * @param h </div><div class="line">     * @param os </div><div class="line">     * @param code </div><div class="line">     * @throws IOException </div><div class="line">     */  </div><div class="line">    public static void outputImage(int w, int h, OutputStream os, String code) throws IOException&#123;  </div><div class="line">        int verifySize = code.length();  </div><div class="line">        BufferedImage image = new BufferedImage(w, h, BufferedImage.TYPE_INT_RGB);  </div><div class="line">        Random rand = new Random();  </div><div class="line">        Graphics2D g2 = image.createGraphics();  </div><div class="line">        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);  </div><div class="line">        Color[] colors = new Color[5];  </div><div class="line">        Color[] colorSpaces = new Color[] &#123; Color.WHITE, Color.CYAN,  </div><div class="line">                Color.GRAY, Color.LIGHT_GRAY, Color.MAGENTA, Color.ORANGE,  </div><div class="line">                Color.PINK, Color.YELLOW &#125;;  </div><div class="line">        <span class="built_in">float</span>[] fractions = new <span class="built_in">float</span>[colors.length];  </div><div class="line">        <span class="keyword">for</span>(int i = 0; i &lt; colors.length; i++)&#123;  </div><div class="line">            colors[i] = colorSpaces[rand.nextInt(colorSpaces.length)];  </div><div class="line">            fractions[i] = rand.nextFloat();  </div><div class="line">        &#125;  </div><div class="line">        Arrays.sort(fractions);  </div><div class="line">          </div><div class="line">        g2.setColor(Color.GRAY);// 设置边框色  </div><div class="line">        g2.fillRect(0, 0, w, h);  </div><div class="line">          </div><div class="line">        Color c = getRandColor(200, 250);  </div><div class="line">        g2.setColor(c);// 设置背景色  </div><div class="line">        g2.fillRect(0, 2, w, h-4);  </div><div class="line">          </div><div class="line">        //绘制干扰线  </div><div class="line">        Random random = new Random();  </div><div class="line">        g2.setColor(getRandColor(160, 200));// 设置线条的颜色  </div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; 20; i++) &#123;  </div><div class="line">            int x = random.nextInt(w - 1);  </div><div class="line">            int y = random.nextInt(h - 1);  </div><div class="line">            int xl = random.nextInt(6) + 1;  </div><div class="line">            int yl = random.nextInt(12) + 1;  </div><div class="line">            g2.drawLine(x, y, x + xl + 40, y + yl + 20);  </div><div class="line">        &#125;  </div><div class="line">          </div><div class="line">        // 添加噪点  </div><div class="line">        <span class="built_in">float</span> yawpRate = 0.05f;// 噪声率  </div><div class="line">        int area = (int) (yawpRate * w * h);  </div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; area; i++) &#123;  </div><div class="line">            int x = random.nextInt(w);  </div><div class="line">            int y = random.nextInt(h);  </div><div class="line">            int rgb = getRandomIntColor();  </div><div class="line">            image.setRGB(x, y, rgb);  </div><div class="line">        &#125;  </div><div class="line">          </div><div class="line">        shear(g2, w, h, c);// 使图片扭曲  </div><div class="line">  </div><div class="line">        g2.setColor(getRandColor(100, 160));  </div><div class="line">        int fontSize = h-4;  </div><div class="line">        Font font = new Font(<span class="string">"Algerian"</span>, Font.ITALIC, fontSize);  </div><div class="line">        g2.setFont(font);  </div><div class="line">        char[] chars = code.toCharArray();  </div><div class="line">        <span class="keyword">for</span>(int i = 0; i &lt; verifySize; i++)&#123;  </div><div class="line">            AffineTransform affine = new AffineTransform();  </div><div class="line">            affine.setToRotation(Math.PI / 4 * rand.nextDouble() * (rand.nextBoolean() ? 1 : -1), (w / verifySize) * i + fontSize/2, h/2);  </div><div class="line">            g2.setTransform(affine);  </div><div class="line">            g2.drawChars(chars, i, 1, ((w-10) / verifySize) * i + 5, h/2 + fontSize/2 - 10);  </div><div class="line">        &#125;  </div><div class="line">          </div><div class="line">        g2.dispose();  </div><div class="line">        ImageIO.write(image, <span class="string">"jpg"</span>, os);  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    private static Color getRandColor(int <span class="built_in">fc</span>, int bc) &#123;  </div><div class="line">        <span class="keyword">if</span> (<span class="built_in">fc</span> &gt; 255)  </div><div class="line">            <span class="built_in">fc</span> = 255;  </div><div class="line">        <span class="keyword">if</span> (bc &gt; 255)  </div><div class="line">            bc = 255;  </div><div class="line">        int r = <span class="built_in">fc</span> + random.nextInt(bc - <span class="built_in">fc</span>);  </div><div class="line">        int g = <span class="built_in">fc</span> + random.nextInt(bc - <span class="built_in">fc</span>);  </div><div class="line">        int b = <span class="built_in">fc</span> + random.nextInt(bc - <span class="built_in">fc</span>);  </div><div class="line">        <span class="built_in">return</span> new Color(r, g, b);  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    private static int <span class="function"><span class="title">getRandomIntColor</span></span>() &#123;  </div><div class="line">        int[] rgb = getRandomRgb();  </div><div class="line">        int color = 0;  </div><div class="line">        <span class="keyword">for</span> (int c : rgb) &#123;  </div><div class="line">            color = color &lt;&lt; 8;  </div><div class="line">            color = color | c;  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">return</span> color;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    private static int[] <span class="function"><span class="title">getRandomRgb</span></span>() &#123;  </div><div class="line">        int[] rgb = new int[3];  </div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; 3; i++) &#123;  </div><div class="line">            rgb[i] = random.nextInt(255);  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">return</span> rgb;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    private static void shear(Graphics g, int w1, int h1, Color color) &#123;  </div><div class="line">        shearX(g, w1, h1, color);  </div><div class="line">        shearY(g, w1, h1, color);  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    private static void shearX(Graphics g, int w1, int h1, Color color) &#123;  </div><div class="line">  </div><div class="line">        int period = random.nextInt(2);  </div><div class="line">  </div><div class="line">        boolean borderGap = <span class="literal">true</span>;  </div><div class="line">        int frames = 1;  </div><div class="line">        int phase = random.nextInt(2);  </div><div class="line">  </div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; h1; i++) &#123;  </div><div class="line">            double d = (double) (period &gt;&gt; 1)  </div><div class="line">                    * Math.sin((double) i / (double) period  </div><div class="line">                            + (6.2831853071795862D * (double) phase)  </div><div class="line">                            / (double) frames);  </div><div class="line">            g.copyArea(0, i, w1, 1, (int) d, 0);  </div><div class="line">            <span class="keyword">if</span> (borderGap) &#123;  </div><div class="line">                g.setColor(color);  </div><div class="line">                g.drawLine((int) d, i, 0, i);  </div><div class="line">                g.drawLine((int) d + w1, i, w1, i);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    private static void shearY(Graphics g, int w1, int h1, Color color) &#123;  </div><div class="line">  </div><div class="line">        int period = random.nextInt(40) + 10; // 50;  </div><div class="line">  </div><div class="line">        boolean borderGap = <span class="literal">true</span>;  </div><div class="line">        int frames = 20;  </div><div class="line">        int phase = 7;  </div><div class="line">        <span class="keyword">for</span> (int i = 0; i &lt; w1; i++) &#123;  </div><div class="line">            double d = (double) (period &gt;&gt; 1)  </div><div class="line">                    * Math.sin((double) i / (double) period  </div><div class="line">                            + (6.2831853071795862D * (double) phase)  </div><div class="line">                            / (double) frames);  </div><div class="line">            g.copyArea(i, 0, 1, h1, 0, (int) d);  </div><div class="line">            <span class="keyword">if</span> (borderGap) &#123;  </div><div class="line">                g.setColor(color);  </div><div class="line">                g.drawLine(i, (int) d, i, 0);  </div><div class="line">                g.drawLine(i, (int) d + h1, i, h1);  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">    &lt;!-- 测试生成50张图片文件 --&gt;</div><div class="line">    public static void main(String[] args) throws IOException&#123;  </div><div class="line">        File dir = new File(<span class="string">"E:/verifies"</span>);  </div><div class="line">        int w = 200, h = 80;  </div><div class="line">        <span class="keyword">for</span>(int i = 0; i &lt; 50; i++)&#123;  </div><div class="line">            String verifyCode = generateVerifyCode(4);  </div><div class="line">            File file = new File(dir, verifyCode + <span class="string">".jpg"</span>);  </div><div class="line">            outputImage(w, h, file, verifyCode);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用servlet实现图片验证码"><a href="#使用servlet实现图片验证码" class="headerlink" title="使用servlet实现图片验证码"></a>使用servlet实现图片验证码</h3><p>web.xml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;servlet&gt;  </div><div class="line">    &lt;servlet-name&gt;AuthImage&lt;/servlet-name&gt;  </div><div class="line">    &lt;servlet-class&gt;com.utils.AuthImage&lt;/servlet-class&gt;  </div><div class="line">   &lt;/servlet&gt;</div><div class="line">   &lt;servlet-mapping&gt;  </div><div class="line">    &lt;servlet-name&gt;AuthImage&lt;/servlet-name&gt;  </div><div class="line">    &lt;url-pattern&gt;/authImage&lt;/url-pattern&gt;  </div><div class="line">&lt;/servlet-mapping&gt;  </div><div class="line">&lt;servlet-name&gt;ValidateImgCode&lt;/servlet-name&gt;  </div><div class="line">   	&lt;servlet-class&gt;com.utils.ValidateImgCode&lt;/servlet-class&gt;  </div><div class="line">   &lt;/servlet&gt;</div><div class="line">   &lt;servlet-mapping&gt;  </div><div class="line">    &lt;servlet-name&gt;ValidateImgCode&lt;/servlet-name&gt;  </div><div class="line">    &lt;url-pattern&gt;/validateImgCode&lt;/url-pattern&gt;  </div><div class="line">   &lt;/servlet-mapping&gt;</div></pre></td></tr></table></figure>
<p>生成验证码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">package com.utils;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line"></div><div class="line">import javax.servlet.ServletException;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import javax.servlet.http.HttpSession;</div><div class="line"></div><div class="line">public class AuthImage  extends javax.servlet.http.HttpServlet implements javax.servlet.Servlet&#123;</div><div class="line">	static final long serialVersionUID = 1L;  </div><div class="line">	  </div><div class="line">    public void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;  </div><div class="line">        response.setHeader(<span class="string">"Pragma"</span>, <span class="string">"No-cache"</span>);  </div><div class="line">        response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-cache"</span>);  </div><div class="line">        response.setDateHeader(<span class="string">"Expires"</span>, 0);  </div><div class="line">        response.setContentType(<span class="string">"image/jpeg"</span>);  </div><div class="line">          </div><div class="line">        //生成随机字串  </div><div class="line">        String verifyCode = VerifyCodeUtils.generateVerifyCode(4);  </div><div class="line">        //存入会话session  </div><div class="line">        HttpSession session = request.getSession(<span class="literal">true</span>);  </div><div class="line">        session.setAttribute(<span class="string">"rand"</span>, verifyCode.toLowerCase());  </div><div class="line">        //生成图片  </div><div class="line">        int w = 200, h = 80;  </div><div class="line">        VerifyCodeUtils.outputImage(w, h, response.getOutputStream(), verifyCode);  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>校验验证码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">package com.utils;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import java.io.PrintWriter;</div><div class="line"></div><div class="line">import javax.servlet.ServletException;</div><div class="line">import javax.servlet.http.HttpServlet;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line">public class ValidateImgCode extends HttpServlet &#123;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * </div><div class="line">	 */</div><div class="line">	private static final long serialVersionUID = 1L;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		response.setCharacterEncoding(<span class="string">"utf-8"</span>);</div><div class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</div><div class="line">		PrintWriter out = response.getWriter();</div><div class="line">		</div><div class="line">		String code = (String)request.getSession().getAttribute(<span class="string">"rand"</span>);</div><div class="line">		String ImageCode = request.getParameter(<span class="string">"code"</span>);</div><div class="line">		<span class="keyword">if</span>(ImageCode.equals(code))&#123;</div><div class="line">			out.println(<span class="literal">true</span>);</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			out.println(<span class="literal">false</span>);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用spring实现图片验证码"><a href="#使用spring实现图片验证码" class="headerlink" title="使用spring实现图片验证码"></a>使用spring实现图片验证码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">package com.utils;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import javax.servlet.http.HttpSession;</div><div class="line"></div><div class="line">import org.springframework.stereotype.Controller;</div><div class="line">import org.springframework.util.StringUtils;</div><div class="line">import org.springframework.web.bind.annotation.RequestMapping;</div><div class="line">import org.springframework.web.bind.annotation.ResponseBody;</div><div class="line"></div><div class="line">@Controller</div><div class="line">public class AuthImageSpring &#123;   </div><div class="line">	@RequestMapping(value=<span class="string">"/toImg"</span>)</div><div class="line">	public String <span class="function"><span class="title">toImg</span></span>()&#123;</div><div class="line"></div><div class="line">        <span class="built_in">return</span> <span class="string">"image/image"</span>;</div><div class="line">    &#125;</div><div class="line">	 @RequestMapping(<span class="string">"/getSysManageLoginCode"</span>)</div><div class="line">	 @ResponseBody</div><div class="line">	 public String getSysManageLoginCode(HttpServletResponse response,</div><div class="line">	            HttpServletRequest request) &#123;</div><div class="line">		    response.setHeader(<span class="string">"Pragma"</span>, <span class="string">"No-cache"</span>);  </div><div class="line">	        response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-cache"</span>);  </div><div class="line">	        response.setDateHeader(<span class="string">"Expires"</span>, 0);  </div><div class="line">	        response.setContentType(<span class="string">"image/jpeg"</span>);  </div><div class="line">	          </div><div class="line">	        //生成随机字串  </div><div class="line">	        String verifyCode = VerifyCodeUtils.generateVerifyCode(4);  </div><div class="line">	        //存入会话session  </div><div class="line">	        HttpSession session = request.getSession(<span class="literal">true</span>);  </div><div class="line">	        session.setAttribute(<span class="string">"rand"</span>, verifyCode.toLowerCase());  </div><div class="line">	        //生成图片 宽高 </div><div class="line">	        int w = 200, h = 80;  </div><div class="line">	        try &#123;</div><div class="line">				VerifyCodeUtils.outputImage(w, h, response.getOutputStream(), verifyCode);</div><div class="line">			&#125; catch (IOException e) &#123;</div><div class="line">				// TODO Auto-generated catch block</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;  </div><div class="line">	        <span class="built_in">return</span> <span class="string">""</span>;</div><div class="line">	    &#125;</div><div class="line">	 </div><div class="line">	 @RequestMapping(value = <span class="string">"/checkimagecode"</span>)</div><div class="line">	 @ResponseBody</div><div class="line">	 public String checkImageCode(HttpServletResponse response,</div><div class="line">	            HttpServletRequest request)&#123;</div><div class="line">		 String validateCode = request.getParameter(<span class="string">"code"</span>);</div><div class="line">		 String code = (String)request.getSession().getAttribute(<span class="string">"rand"</span>);</div><div class="line">	</div><div class="line">		</div><div class="line">	        <span class="keyword">if</span>(!StringUtils.isEmpty(validateCode) &amp;&amp; validateCode.equals(code))&#123;</div><div class="line">	            <span class="built_in">return</span> <span class="string">"ok"</span>;    </div><div class="line"></div><div class="line">	        &#125;</div><div class="line">	        <span class="built_in">return</span> <span class="string">"error"</span>;</div><div class="line">	</div><div class="line">	 &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
            </div>

			
            <section class="comment">
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/blog/2017/07/04/java之图片验证码/" data-title="java之图片验证码" data-url="http://code-helloworld.com/blog/2017/07/04/java之图片验证码/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"YOUR_DUOSHUO_SHORT_NAME"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</section>
        </div>
    </div>
</article>

    <footer id="footer">
    	<br />
        <small>this blog power by <a href="https://hexo.io/" target="_blank">Hexo</a><br />
        <small>&copy; 2014 parry</small>
    </footer>

    


</body>
</html>

